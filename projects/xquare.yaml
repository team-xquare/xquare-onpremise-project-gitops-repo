applications:
  - name: xquare-supporter-prod
    github:
      owner: team-xquare
      repo: xquare-community-manager
      branch: main
      installationId: "62433388"
      hash: e1405a7c9f9e81ae1b8c01dd9ace76c3856e838b
    build:
      docker:
        dockerfilePath: "./Dockerfile"
        contextPath: "."
  - name: infra-backend-stag
    disableNetworkPolicy: true
    github:
      owner: team-xquare
      repo: xquare-infra-backend-v3
      branch: develop
      installationId: "62433388"
      hash: 6d1ddb42ea53133dbb67d299902ffda15ee63e46
    build:
      gradle:
        javaVersion: 17
        jarOutputPath: /build/libs/*.jar
        buildCommand: ./gradlew bootJar -x test
    endpoints:
      - port: 8080
        routes:
          - infra-backend-stag.dsmhs.kr
  - name: infra-backend-prod
    disableNetworkPolicy: true
    github:
      owner: team-xquare
      repo: xquare-infra-backend-v3
      branch: main
      installationId: "62433388"
      hash: a1f4e3a1f6e32de904c3005cb04e7dbce65bdfe8
    build:
      gradle:
        javaVersion: 17
        jarOutputPath: /build/libs/*.jar
        buildCommand: ./gradlew bootJar -x test
    endpoints:
      - port: 8080
        routes:
          - infra-backend.dsmhs.kr
  - name: infra-frontend-stag
    github:
      owner: team-xquare
      repo: xquare-infra-frontend-v3
      branch: develop
      installationId: "62433388"
      hash: 5a5ba8de64cb1b3909f21ee6faddb71642c2f697
    build:
      vite:
        nodeVersion: 20
        buildCommand: npm install -g bun@1.3.5 && bun install --frozen-lockfile && bun x turbo build --filter=@xquare/user-application
        distPath: /applications/xquare-user-application/dist
    endpoints:
      - port: 8080
        routes:
          - xquare-stag.dsmhs.kr
  - name: infra-frontend-prod
    github:
      owner: team-xquare
      repo: xquare-infra-frontend-v3
      branch: main
      installationId: "62433388"
      hash: b8b1063622ab2c367ba68c2cfefa6e74d549a3ee
    build:
      vite:
        nodeVersion: 20
        buildCommand: npm install -g bun@1.3.5 && bun install --frozen-lockfile && bun x turbo build --filter=@xquare/user-application
        distPath: /applications/xquare-user-application/dist
    endpoints:
      - port: 8080
        routes:
          - xquare.dsmhs.kr
addons:
  - name: xquare-supporter-mongodb
    type: mongodb
    storage: 1Gi
  - name: xquare-infra-mysql
    type: mysql
    storage: 1Gi
  - name: xquare-infra-mysql-stag
    type: mysql
    storage: 1Gi
